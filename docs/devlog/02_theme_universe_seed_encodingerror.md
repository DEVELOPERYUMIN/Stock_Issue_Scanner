

````markdown
## 테마 → 종목(티커) 매핑 데이터 적재 (2025-02-07)

### 목표

FastAPI 기반 스캐너가 동작하기 위해서는  
**“테마 ↔ 종목(티커)”의 고정된 세계관**이 먼저 DB에 존재해야 한다.

이 단계에서는:

- 테마–종목 매핑 데이터를 CSV로 준비하고
- 이를 DB에 적재하여
- 이후 **거래량 / 뉴스 데이터가 종목 단위로 누적될 수 있는 기반**을 마련한다.

---

## 왜 이 단계가 필요한가?

이 프로젝트의 모든 분석 단위는 결국 **종목(ticker)**이다.

- 거래 데이터 → 종목 기준
- 뉴스 → 종목 기준
- 테마 분석 → “어떤 종목들이 같은 테마인가?”를 기준으로 집계

즉,

> **테마는 고정된 분류 체계이고,  
> 데이터는 종목 단위로 시간에 따라 쌓인다.**

이를 위해 테마–종목 매핑 테이블(`theme_universe`)을  
가장 먼저 DB에 심어두는 것이 필요하다.

---

## 구현 방식

- 예시 데이터를 담은 CSV 파일을 준비
- Python ETL 스크립트로 CSV → DB 적재
- 중복 데이터에 대비해 **UPSERT 방식** 사용

```text
data/seed/theme_universe.csv
        ↓
collector/load_theme_universe.py
        ↓
DB: theme_universe 테이블
````

---

## 발생한 문제: 한글 깨짐 이슈

CSV를 통해 데이터를 적재한 후,
DB에서 조회해보니 **테마명/종목명이 한글 깨짐 상태로 저장**되는 문제가 발생했다.

---

## 원인 분석

* MySQL 서버 자체는 `utf8mb4`로 설정되어 있었음
* 하지만 **클라이언트(파이썬 SQLAlchemy 연결)**의 문자셋이 명시되지 않음
* 결과적으로:

  * 서버 ↔ 클라이언트 간 문자셋 불일치
  * 한글 데이터가 잘못 인코딩되어 저장됨

---

## 해결 방법

`.env`에 설정된 `DATABASE_URL`에
**명시적으로 charset을 지정**하여 해결했다.

```env
DATABASE_URL=mysql+pymysql://sis_user:sis_password@localhost:3307/stock_issue_scanner?charset=utf8mb4
```

이후:

* CSV → DB 적재 시 한글 정상 저장
* 조회 결과도 문제없이 출력됨

---

## 이 단계에서 얻은 것

* 테마–종목 매핑이 **DB에 고정된 세계관으로 자리잡음**
* 종목 단위로:

  * 거래 데이터
  * 뉴스 데이터
  * 시간 흐름 데이터
    를 누적할 수 있는 구조 완성

즉,

> **이제부터는 “세계관 위에 데이터만 쌓으면 되는 상태”**

가 되었다.

---

## 다음 단계 예고

다음 단계에서는:

* `market_daily` 테이블을 통해
* **종목 × 날짜 단위의 거래량/거래대금 데이터를 적재**
* 이후 `VOL_RATIO`, `TODAY_VALUE` 같은
  스캐너 핵심 지표 계산으로 넘어간다.

```

---

